name: helium-browser # CHANGE THIS to your registered snap name
base: core24
version: '0.0.1' # Updated automatically by the workflow
summary: Private, fast, and honest web browser based on Chromium
description: |
  Helium is a bullshit-free web browser based on Chromium.
  It is designed to be fast, private, and honest.
  
  Based on the AUR package: helium-browser-bin

grade: stable
confinement: strict
license: GPL-3.0-only AND BSD-3-Clause

website: https://github.com/imputnet/helium-linux
source-code: https://github.com/imputnet/helium-linux
issues: https://github.com/imputnet/helium-linux/issues

# Platforms will be injected automatically by main.yml

apps:
  helium:
    # We point directly to the binary. The gnome extension handles the env vars.
    command: helium
    extensions: [gnome]
    common-id: helium.desktop
    # Plugs mapped from AUR depends/optdepends
    plugs:
      - network
      - network-bind
      - audio-playback
      - audio-record          # Microphone
      - camera                # Webcam
      - opengl                # GPU Acceleration (libva)
      - x11
      - wayland
      - browser-support
      - removable-media
      - home
      - desktop
      - desktop-legacy
      - unity7
      - screen-inhibit-control
      - cups-control          # Matches 'libcups'
      - joystick
      - password-manager-service # Matches 'org.freedesktop.secrets' / 'kwallet'
      - u2f-devices
      - raw-usb
      - upower-observe        # Matches 'upower' optdepend

parts:
  helium:
    plugin: dump
    source: https://github.com/imputnet/helium-linux/releases/latest
    source-type: tar
    
    # Logic to handle the directory structure from the tarball
    override-build: |
      craftctl default
      # Move files from the versioned folder to the root
      find $SNAPCRAFT_PART_INSTALL -mindepth 2 -maxdepth 2 -name "helium" -exec mv {}/../* $SNAPCRAFT_PART_INSTALL/ \;
      find $SNAPCRAFT_PART_INSTALL -type d -empty -delete
      
      # Ensure the wrapper matches the binary name expected by Snapcraft
      if [ -f "$SNAPCRAFT_PART_INSTALL/helium-wrapper" ]; then
        chmod +x $SNAPCRAFT_PART_INSTALL/helium-wrapper
      fi

    # Dependencies mapped from AUR -> Ubuntu 24.04 (Core24)
    stage-packages:
      # Core Deps (gtk3, nss, alsa, etc.)
      - libgtk-3-0
      - libnss3
      - libnspr4
      - libasound2t64
      - libxss1
      - xdg-utils
      - libcups2t64       # libcups
      - libgcrypt20       # libgcrypt
      - libpulse0         # libpulse
      - libpci3           # pciutils
      - libffi8           # libffi
      
      # Video Acceleration (libva)
      - libva2
      - libva-drm2
      - libva-x11-2
      - mesa-va-drivers
      
      # Chromium/Graphics specifics
      - libgbm1
      - libdrm2
      - libvulkan1
      - mesa-vulkan-drivers
      - libgl1
      - libegl1
      - libgl1-mesa-dri
      
      # Fonts (ttf-liberation)
      - fonts-liberation
      - fonts-noto
      - fonts-noto-color-emoji
      - fontconfig
      - libfontconfig1
      
      # Hardware
      - libu2f-udev